---
let path = Astro.url.searchParams.get("u");
if (!path) {
    return Astro.redirect("/");
}
let ctr = /^(application|text)\/(javascript|x-javascript).*/i;
let url_obj;
try {
    url_obj = new URL(path);
} catch (error) {
    return Astro.redirect("/");
}
if (url_obj.href.includes(Astro.url.hostname)) {
    return new Response("Realy try to make a loop ?", { status: 400 });
}
let data = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(url_obj.href)}`);
if (!ctr.test(data.headers.get("Content-Type") || "")) {
    return new Response("This is not a script", { status: 400 });
}
return data;
---